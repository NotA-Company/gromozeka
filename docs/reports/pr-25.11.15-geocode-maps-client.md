# Pull Request: Add Geocode Maps Client Implementation

**Author:** Vladimir Goshev
**Date Created:** 2025-11-15
**Target Branch:** master
**Source Branch:** add-geocode-maps-client

## Brief Description

This PR implements a comprehensive Geocode Maps client library that provides geocoding and reverse geocoding functionality for the Gromozeka project. The implementation includes a generic cache interface that replaces the previous cache implementations in OpenWeatherMap and Yandex Search clients, improving code reusability and maintainability.

**Key Change:** Added Geocode Maps client with generic cache interface and integrated it into the weather handler.

**Commit Message Format:**
```
feat(geocode): add geocode maps client with generic cache interface

Implemented a comprehensive Geocode Maps client library with support for forward and reverse geocoding. Created a generic cache interface that replaces cache implementations in OpenWeatherMap and Yandex Search clients. Integrated the new geocoder into the weather handler to improve location resolution.

Closes: #issue-number (if applicable)
```

## –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç PR —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É Geocode Maps, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ Gromozeka. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫—ç—à–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–º–µ–Ω—è–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫—ç—à–∞ –≤ –∫–ª–∏–µ–Ω—Ç–∞—Ö OpenWeatherMap –∏ Yandex Search, —É–ª—É—á—à–∞—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∏ –µ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å.

**–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç Geocode Maps —Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∫—ç—à–∞ –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–≥–æ–¥—ã.

## Changed Files

```git diff $(git merge-base master HEAD) --stat
 TODO.md                                                                 |    2 +-
 configs/00-defaults/00-config.toml                                      |   30 +-
 docs/design/geocode-maps-client-design-v0.md                            |   17 +
 docs/design/geocode-maps-client-design-v1.md                            | 1180 +++++++++++++++++++++++++++++++++++++++++++++++++++++++
 docs/design/lib-cache-design-v0.md                                      |  536 +++++++++++++++++++++++++
 docs/other/geocode-maps/Geocode-Maps-API.md                             |  154 ++++++++
 docs/other/geocode-maps/lookup-Angarsk-jsonv2.json                      |   91 +++++
 docs/other/geocode-maps/reverse-Angarsk-jsonv2.json                     |   41 ++
 docs/other/geocode-maps/search-Angarsk-jsonv2.json                      |   90 +++++
 docs/plans/lib-cache-implementation-plan.md                             |  419 ++++++++++++++++++++
 docs/reports/geocode-maps-client-implementation-report.md               |  503 ++++++++++++++++++++++++
 docs/reports/lib-cache-dict-cache-implementation-report.md              |  257 ++++++++++++
 docs/reports/lib-cache-implementation-report.md                         |  717 +++++++++++++++++++++++++++++++++
 docs/reports/pr-25.11.14-generic-cache-interface.md                     |  346 ++++++++++++++++
 docs/reports/task-4.0.0-telegram-markdownv2-utilities-report.md         |    2 +-
 docs/templates/task-report-template.md                                  |    2 -
 internal/bot/handlers/weather.py                                        |  575 +++++++++++++++------------
 internal/bot/handlers/yandex_search.py                                  |   14 +-
 internal/config/manager.py                                              |    4 +
 internal/database/generic_cache.py                                      |  120 ++++++
 internal/database/migrations/versions/migration_006_new_cache_tables.py |   46 +++
 internal/database/models.py                                             |    5 +
 internal/database/openweathermap_cache.py                               |   71 ----
 internal/database/wrapper.py                                            |   26 +-
 internal/database/yandexsearch_cache.py                                 |  162 --------
 lib/aurumentation/collector.py                                          |    2 +
 lib/cache/README.md                                                     |  794 +++++++++++++++++++++++++++++++++++++
 lib/cache/__init__.py                                                   |   64 +++
 lib/cache/dict_cache.py                                                 |  249 ++++++++++++
 lib/cache/interface.py                                                  |  133 +++++++
 lib/cache/key_generator.py                                              |  219 +++++++++++
 lib/cache/null_cache.py                                                 |   79 ++++
 lib/cache/test_dict_cache.py                                            |  396 +++++++++++++++++++
 lib/cache/test_integration.py                                           |  650 ++++++++++++++++++++++++++++++
 lib/cache/test_null_cache.py                                            |  153 ++++++++
 lib/cache/types.py                                                      |   87 ++++
 lib/cache/value_converter.py                                            |   76 ++++
 lib/geocode_maps/README.md                                              |  251 ++++++++++++
 lib/geocode_maps/__init__.py                                            |   54 +++
 lib/geocode_maps/client.py                                              |  474 ++++++++++++++++++++++
 lib/geocode_maps/models.py                                              |  142 +++++++
 lib/geocode_maps/test_client.py                                         |  335 ++++++++++++++++
 lib/openweathermap/__init__.py                                          |    6 -
 lib/openweathermap/cache_interface.py                                   |   69 ----
 lib/openweathermap/client.py                                            |   51 ++-
 lib/openweathermap/dict_cache.py                                        |  167 --------
 lib/openweathermap/examples.py                                          |  319 ---------------
 lib/openweathermap/null_cache.py                                        |   68 ----
 lib/openweathermap/test_dict_cache.py                                   |  479 ----------------------
 lib/openweathermap/test_weather_client.py                               |  578 +++------------------------
 lib/yandex_search/README.md                                             |  525 -------------------------
 lib/yandex_search/__init__.py                                           |   18 +-
 lib/yandex_search/cache_interface.py                                    |  166 --------
 lib/yandex_search/cache_utils.py                                        |   62 +++
 lib/yandex_search/client.py                                             |  311 ++++-----------
 lib/yandex_search/dict_cache.py                                         |  445 ---------------------
 lib/yandex_search/examples.py                                           |  442 ---------------------
 lib/yandex_search/test_client.py                                        |   31 +-
 lib/yandex_search/test_dict_cache.py                                    |  517 ------------------------
 lib/yandex_search/test_integration.py                                   |   51 +--
 lib/yandex_search/test_performance.py                                   |  100 +----
 memory-bank/activeContext.md                                            |   37 +-
 memory-bank/decisionLog.md                                              |   20 +-
 memory-bank/progress.md                                                 |   47 ++-
 tests/geocode_maps/__init__.py                                          |    0
 tests/geocode_maps/golden/__init__.py                                   |    5 +
 tests/geocode_maps/golden/collect.py                                    |  102 +++++
 tests/geocode_maps/golden/data/Angarsk Relation Lookup.json             |   65 +++
 tests/geocode_maps/golden/data/Angarsk Reverse.json                     |   61 +++
 tests/geocode_maps/golden/data/Angarsk Russia Search.json               |   61 +++
 tests/geocode_maps/golden/data/Moscow RU Search.json                    |   61 +++
 tests/geocode_maps/golden/data/Moscow cyrilic Search.json               |   61 +++
 tests/geocode_maps/golden/data/Tokyo Coordinates Reverse with Zoom.json |   63 +++
 tests/geocode_maps/golden/data/Tverskaya Street Search.json             |   61 +++
 tests/geocode_maps/golden/input/scenarios.json                          |  110 ++++++
 tests/geocode_maps/golden/test_golden.py                                |   78 ++++
 tests/integration/test_database_operations.py                           |    8 +-
 tests/lib_ratelimiter/__init__.py                                       |   46 +++
 tests/lib_utils/__init__.py                                             |    0
 {lib/tests => tests/lib_utils}/test_utils.py                            |    0
 tests/openweathermap/golden/test_golden.py                              |    2 +
 tests/telegram_handlers/test_weather_handler.py                         |  951 --------------------------------------------
 tests/yandex_search/golden/test_golden.py                               |   32 +-
 83 files changed, 10193 insertions(+), 5651 deletions(-)
```

**Detailed Changes:**
- [`lib/geocode_maps/client.py`](lib/geocode_maps/client.py) - Main implementation of the Geocode Maps client with forward and reverse geocoding functionality
- [`lib/cache/interface.py`](lib/cache/interface.py) - Generic cache interface that replaces specific cache implementations
- [`lib/cache/dict_cache.py`](lib/cache/dict_cache.py) - Dictionary-based cache implementation using the generic interface
- [`internal/bot/handlers/weather.py`](internal/bot/handlers/weather.py) - Updated to use the new Geocode Maps client for location resolution
- [`internal/database/generic_cache.py`](internal/database/generic_cache.py) - Database backend for the generic cache interface
- [`configs/00-defaults/00-config.toml`](configs/00-defaults/00-config.toml) - Added configuration for the Geocode Maps client

### Files Created
- [`lib/geocode_maps/__init__.py`](lib/geocode_maps/__init__.py) - Package initialization for the Geocode Maps client
- [`lib/geocode_maps/models.py`](lib/geocode_maps/models.py) - Data models for geocoding requests and responses
- [`lib/geocode_maps/test_client.py`](lib/geocode_maps/test_client.py) - Unit tests for the Geocode Maps client
- [`lib/cache/__init__.py`](lib/cache/__init__.py) - Package initialization for the generic cache library
- [`lib/cache/types.py`](lib/cache/types.py) - Type definitions for the cache interface
- [`lib/cache/key_generator.py`](lib/cache/key_generator.py) - Utility for generating cache keys
- [`tests/geocode_maps/golden/test_golden.py`](tests/geocode_maps/golden/test_golden.py) - Golden tests for the Geocode Maps client

### Files Deleted
- [`lib/openweathermap/cache_interface.py`](lib/openweathermap/cache_interface.py) - Removed in favor of the generic cache interface
- [`lib/openweathermap/dict_cache.py`](lib/openweathermap/dict_cache.py) - Removed in favor of the generic cache implementation
- [`lib/yandex_search/cache_interface.py`](lib/yandex_search/cache_interface.py) - Removed in favor of the generic cache interface
- [`lib/yandex_search/dict_cache.py`](lib/yandex_search/dict_cache.py) - Removed in favor of the generic cache implementation

## Commit History

```git log master..HEAD --pretty=format:"%h - %an, %ai : %s"
b256e8e - Vladimir Goshev, 2025-11-15 21:51:00 +0300 : Update TODO
a89cca2 - Vladimir Goshev, 2025-11-15 21:50:10 +0300 : Integrate new geocoder into weather handler
523764c - Vladimir Goshev, 2025-11-15 14:41:14 +0300 : Integrate Geocode Maps client into weather handler
1caae2f - Vladimir Goshev, 2025-11-15 12:30:23 +0300 : Move Geocode Maps docs into separate directory
b8326d7 - Vladimir Goshev, 2025-11-15 12:26:17 +0300 : Add Aurumentation tests for lib.geocode_map
a6a9afe - Vladimir Goshev, 2025-11-14 23:54:26 +0300 : Tiny fixes
777fa78 - Vladimir Goshev, 2025-11-14 23:32:18 +0300 : Add Geocode Maps Client
9e96d37 - Vladimir Goshev, 2025-11-14 21:46:26 +0300 : Shitty LLM created test for buggy implementation while it knows, that implementation is buggy. -_-
54e91c0 - Vladimir Goshev, 2025-11-14 21:42:28 +0300 : Prettify example JSONs
be82be8 - Vladimir Goshev, 2025-11-14 21:35:46 +0300 : Design doc for client
617d0b9 - Vladimir Goshev, 2025-11-14 21:30:35 +0300 : Fixed updateChatMessageCategory(): category -> message_category
bda8a68 - Vladimir Goshev, 2025-11-14 21:26:02 +0300 : Fix
18102f9 - Vladimir Goshev, 2025-11-14 21:19:37 +0300 : Initial documents for Geocode Maps Client
b179624 - sunx, 2025-11-14 17:38:23 +0000 : Add and use new Generic Cache Interface (!9)
cf39a9f - Vladimir Goshev, 2025-11-14 14:29:39 +0300 : Add docstring to db-wrapper
770a9db - Vladimir Goshev, 2025-11-14 14:24:13 +0300 : Merge remote-tracking branch 'origin/master' into add-geocode-maps-client
89e8d84 - Vladimir Goshev, 2025-11-14 14:18:56 +0300 : Add PR Document
261898f - Vladimir Goshev, 2025-11-14 14:06:01 +0300 : Move tests for utils into /tests
a2ea563 - Vladimir Goshev, 2025-11-14 14:02:43 +0300 : Update docstrings
97f0092 - Vladimir Goshev, 2025-11-14 13:49:05 +0300 : Delete old YandexSearch cache
3dc7905 - Vladimir Goshev, 2025-11-14 13:17:16 +0300 : Yandex Search Client: Use new generic cache interface
1eacc2b - Vladimir Goshev, 2025-11-14 03:29:05 +0300 : Delete deprecater OpenWeatherMap-specific cache
618fab1 - Vladimir Goshev, 2025-11-14 03:25:46 +0300 : Update docstrings
683e2d5 - Vladimir Goshev, 2025-11-14 03:19:55 +0300 : Use New Cache in OpenWeatherMap Client + add DB backend for it
7d4fa45 - Vladimir Goshev, 2025-11-14 02:16:47 +0300 : Make format
4e4c780 - Vladimir Goshev, 2025-11-14 02:16:41 +0300 : Add lib.cache as genegic cache interface
3bf3fb4 - Vladimir Goshev, 2025-11-14 01:01:26 +0300 : Add implementation plan
2472beb - sunx, 2025-11-13 21:57:28 +0000 : Add rate limiter for OpenWeatherMap Client (!8)
8492598 - Vladimir Goshev, 2025-11-14 00:55:52 +0300 : Add generic cache design doc
05d103e - Vladimir Goshev, 2025-11-14 00:55:40 +0300 : better
abf26aa - Vladimir Goshev, 2025-11-14 00:47:37 +0300 : Add config for new Geocode Maps Client
0751a9a - Vladimir Goshev, 2025-11-14 00:39:19 +0300 : Add configured ratelimiter queue
ed11a4d - Vladimir Goshev, 2025-11-14 00:30:23 +0300 : Fix and improve tests
24f0838 - Vladimir Goshev, 2025-11-14 00:13:02 +0300 : Add rate-limiter into OpenWeatherMap client
```

**Commit Breakdown:**
1. **b256e8e** - `Update TODO`
   - Updated the TODO list to reflect the completion of the Geocode Maps client implementation
   
2. **a89cca2** - `Integrate new geocoder into weather handler`
   - Final integration of the Geocode Maps client into the weather handler
   
3. **523764c** - `Integrate Geocode Maps client into weather handler`
   - Initial integration of the Geocode Maps client into the weather handler
   
4. **777fa78** - `Add Geocode Maps Client`
   - Main implementation of the Geocode Maps client with all functionality
   
5. **b179624** - `Add and use new Generic Cache Interface (!9)`
   - Implementation of the generic cache interface and its integration into existing clients

## What Was Done

### Features Added ‚ú®
- **Geocode Maps Client:** Complete implementation of a client for the Geocode Maps API
  - **Implementation:** Created a comprehensive client library with support for forward geocoding (location name to coordinates) and reverse geocoding (coordinates to location name)
  - **Benefits:** Provides accurate location resolution for weather requests and other location-based features
  - **Files:** [`lib/geocode_maps/client.py`](lib/geocode_maps/client.py), [`lib/geocode_maps/models.py`](lib/geocode_maps/models.py)

- **Generic Cache Interface:** Universal cache interface that can be used across different services
  - **Implementation:** Created a generic cache interface with multiple implementations (dict cache, null cache, database cache)
  - **Benefits:** Eliminates code duplication and provides consistent caching behavior across services
  - **Files:** [`lib/cache/interface.py`](lib/cache/interface.py), [`lib/cache/dict_cache.py`](lib/cache/dict_cache.py), [`lib/cache/null_cache.py`](lib/cache/null_cache.py)

- **Database Cache Backend:** Persistent cache implementation using the project's database
  - **Implementation:** Created a database-backed cache implementation using the generic cache interface
  - **Benefits:** Provides persistent caching that survives application restarts
  - **Files:** [`internal/database/generic_cache.py`](internal/database/generic_cache.py), [`internal/database/migrations/versions/migration_006_new_cache_tables.py`](internal/database/migrations/versions/migration_006_new_cache_tables.py)

### Bug Fixes üêõ
- **updateChatMessageCategory() parameter name:** Fixed incorrect parameter name
  - **Root Cause:** Parameter was named `category` instead of `message_category`
  - **Solution:** Updated the parameter name to match the expected interface
  - **Impact:** Fixes potential errors when updating chat message categories
  - **Files:** [`internal/bot/handlers/yandex_search.py`](internal/bot/handlers/yandex_search.py)

### Improvements üöÄ
- **Weather Handler Location Resolution:** Improved location resolution in the weather handler
  - **Before:** Limited location resolution capabilities
  - **After:** Enhanced location resolution using the new Geocode Maps client
  - **Benefit:** More accurate weather information for user requests
  - **Files:** [`internal/bot/handlers/weather.py`](internal/bot/handlers/weather.py)

- **Cache Key Generation:** Improved cache key generation for better cache hit rates
  - **Before:** Simple cache key generation that could lead to collisions
  - **After:** Sophisticated cache key generation that minimizes collisions
  - **Benefit:** Improved cache efficiency and reduced API calls
  - **Files:** [`lib/cache/key_generator.py`](lib/cache/key_generator.py)

### Refactoring üîß
- **Cache Interface Consolidation:** Consolidated multiple cache implementations into a single generic interface
  - **Motivation:** Reduce code duplication and improve maintainability
  - **Changes:** Removed specific cache implementations from OpenWeatherMap and Yandex Search clients, replaced with generic cache interface
  - **Impact:** Simplified codebase and made it easier to add new caching features
  - **Files:** [`lib/cache/interface.py`](lib/cache/interface.py), [`lib/openweathermap/client.py`](lib/openweathermap/client.py), [`lib/yandex_search/client.py`](lib/yandex_search/client.py)

- **Test Organization:** Reorganized test files for better structure
  - **Motivation:** Improve test organization and discoverability
  - **Changes:** Moved test files from lib/tests to tests directory
  - **Impact:** Better test organization and consistency with project structure
  - **Files:** [`tests/lib_utils/test_utils.py`](tests/lib_utils/test_utils.py)

### Documentation üìù
- **Geocode Maps Documentation:** Comprehensive documentation for the Geocode Maps client
  - **Type:** API documentation, implementation guide, examples
  - **Changes:** Created detailed documentation explaining how to use the Geocode Maps client
  - **Files:** [`lib/geocode_maps/README.md`](lib/geocode_maps/README.md), [`docs/other/geocode-maps/Geocode-Maps-API.md`](docs/other/geocode-maps/Geocode-Maps-API.md)

- **Cache Interface Documentation:** Documentation for the generic cache interface
  - **Type:** API documentation, implementation guide
  - **Changes:** Created detailed documentation explaining the cache interface and its implementations
  - **Files:** [`lib/cache/README.md`](lib/cache/README.md)

### Tests üß™
- **Geocode Maps Client Tests:** Comprehensive test suite for the Geocode Maps client
  - **Coverage:** Unit tests and golden tests for all client functionality
  - **Type:** Unit/Integration
  - **Files:** [`lib/geocode_maps/test_client.py`](lib/geocode_maps/test_client.py), [`tests/geocode_maps/golden/test_golden.py`](tests/geocode_maps/golden/test_golden.py)

- **Cache Interface Tests:** Test suite for the generic cache interface
  - **Coverage:** Unit tests and integration tests for all cache implementations
  - **Type:** Unit/Integration
  - **Files:** [`lib/cache/test_dict_cache.py`](lib/cache/test_dict_cache.py), [`lib/cache/test_integration.py`](lib/cache/test_integration.py)

### Configuration Changes ‚öôÔ∏è
- **Geocode Maps Client Configuration:** Added configuration options for the Geocode Maps client
  - **Setting:** Added API endpoint, timeout, and rate limiter settings
  - **Reason:** Required for the Geocode Maps client to function properly
  - **Impact:** Enables the Geocode Maps client to connect to the API and manage request rates
  - **Files:** [`configs/00-defaults/00-config.toml`](configs/00-defaults/00-config.toml)

## Testing Performed

```make test
üß™ Running all Gromozeka tests, dood!
==================================

./venv/bin/pytest --durations=4 
========================================================= test session starts ==========================================================
platform darwin -- Python 3.13.7, pytest-8.4.2, pluggy-1.6.0
rootdir: /Users/vgoshev/Development/NotA/gromozeka
configfile: pyproject.toml
testpaths: tests, lib, internal
plugins: asyncio-1.2.0, anyio-4.11.0, cov-7.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collected 1325 items                                                                                                                   

tests/e2e/test_command_execution.py ...                                                                                          [  0%]
tests/e2e/test_message_flow.py .........                                                                                         [  0%]
tests/e2e/test_summarization_flow.py .                                                                                           [  0%]
tests/geocode_maps/golden/test_golden.py .                                                                                       [  1%]
tests/integration/test_command_handlers.py ......                                                                                [  1%]
tests/integration/test_database_operations.py .....................................                                              [  4%]
tests/integration/test_llm_integration.py ..................                                                                     [  5%]
tests/integration/test_spam_detection.py ....................                                                                    [  7%]
tests/lib_ai/golden/test_golden.py ..                                                                                            [  7%]
tests/lib_utils/test_utils.py ......                                                                                             [  7%]
tests/openweathermap/golden/test_golden.py .....                                                                                 [  8%]
tests/performance/test_performance.py ................                                                                           [  9%]
tests/telegram_handlers/test_base_handler.py ..................................................................................  [ 15%]
tests/telegram_handlers/test_command_handler_decorator.py ......                                                                 [ 16%]
tests/telegram_handlers/test_command_handler_decorator_v2.py .                                                                   [ 16%]
tests/telegram_handlers/test_command_order.py .                                                                                  [ 16%]
tests/telegram_handlers/test_common_handler.py ........................                                                          [ 17%]
tests/telegram_handlers/test_dev_commands_handler.py ................................                                            [ 20%]
tests/telegram_handlers/test_help_handler.py .........................                                                           [ 22%]
tests/telegram_handlers/test_llm_messages_handler.py .............................                                               [ 24%]
tests/telegram_handlers/test_media_handler.py ...............                                                                    [ 25%]
tests/telegram_handlers/test_message_preprocessor_handler.py .........................                                           [ 27%]
tests/telegram_handlers/test_spam_handler.py ......................                                                              [ 29%]
tests/telegram_handlers/test_summarization_handler.py .....................                                                      [ 30%]
tests/telegram_handlers/test_user_data_handler.py ........                                                                       [ 31%]
tests/test_db_wrapper.py ....................................................................................................... [ 39%]
..................                                                                                                               [ 40%]
tests/test_llm_service.py ...............................................                                                        [ 44%]
tests/test_queue_service.py ...............................................................                                      [ 48%]
tests/yandex_search/golden/test_golden.py .....                                                                                  [ 49%]
lib/ai/providers/test_basic_openai_provider.py ................................                                                  [ 51%]
lib/ai/providers/test_openrouter_provider.py ............................                                                        [ 53%]
lib/ai/providers/test_yc_openai_provider.py .................................                                                    [ 56%]
lib/ai/test_manager.py ................................                                                                          [ 58%]
lib/bayes_filter/test_bayes_filter.py ................................................                                           [ 62%]
lib/cache/test_dict_cache.py .....................                                                                               [ 63%]
lib/cache/test_integration.py .......................                                                                            [ 65%]
lib/cache/test_null_cache.py .........                                                                                           [ 66%]
lib/geocode_maps/test_client.py ..............                                                                                   [ 67%]
lib/markdown/test/test_code_block_comprehensive.py ..........                                                                    [ 68%]
lib/markdown/test/test_code_block_fixes.py ........                                                                              [ 68%]
lib/markdown/test/test_code_blocks_with_lists.py ........                                                                        [ 69%]
lib/markdown/test/test_edge_cases.py ...............................                                                             [ 71%]
lib/markdown/test/test_ignore_indented_code.py ..                                                                                [ 71%]
lib/markdown/test/test_less_than_fix.py .                                                                                        [ 71%]
lib/markdown/test/test_less_than_symbol.py .                                                                                     [ 71%]
lib/markdown/test/test_malformed_input.py ........................................                                               [ 74%]
lib/markdown/test/test_markdown_parser.py .................................................                                      [ 78%]
lib/markdown/test/test_markdownv2_renderer.py ..................................                                                 [ 81%]
lib/markdown/test/test_nested_lists_comprehensive.py ..                                                                          [ 81%]
lib/markdown/test/test_preserve_options.py .                                                                                     [ 81%]
lib/markdown/test/test_preserve_paragraphs.py .                                                                                  [ 81%]
lib/markdown/test/test_special_characters.py ..............                                                                      [ 82%]
lib/openweathermap/test_weather_client.py ....................................                                                   [ 85%]
lib/rate_limiter/test_integration.py ............                                                                                [ 86%]
lib/rate_limiter/test_manager.py .............................                                                                   [ 88%]
lib/rate_limiter/test_sliding_window.py .........................                                                                [ 90%]
lib/yandex_search/test_client.py ..................                                                                              [ 91%]
lib/yandex_search/test_integration.py .........                                                                                  [ 92%]
lib/yandex_search/test_performance.py ....                                                                                       [ 92%]
lib/yandex_search/test_xml_parser.py ......                                                                                      [ 92%]
internal/config/test_manager.py ................................................                                                 [ 96%]
internal/database/migrations/test_migrations.py ........                                                                         [ 97%]
internal/services/cache/test_cache_service.py .....................................                                              [100%]

========================================================= slowest 4 durations ==========================================================
6.01s call     lib/rate_limiter/test_sliding_window.py::TestSlidingWindowRateLimiter::testLargeNumberOfRequests
2.21s call     lib/cache/test_integration.py::TestCacheRealWorldPatterns::test_caching_computed_results_with_ttl
2.11s call     lib/rate_limiter/test_sliding_window.py::TestSlidingWindowRateLimiter::testSlidingWindowBehavior
2.01s call     lib/rate_limiter/test_integration.py::TestRateLimiterIntegration::testHighConcurrencyScenario
=================================================== 1325 passed in 61.25s (0:01:01) ====================================================

‚úÖ All tests completed, dood!
```

## Additional Notes

- The Geocode Maps client implementation includes comprehensive error handling for API failures and network issues
- The generic cache interface is designed to be extensible, allowing for additional cache implementations in the future
- Rate limiting has been implemented for the Geocode Maps client to prevent API abuse
- The database migration for the new cache tables is backward compatible with existing data
- Golden tests have been added for the Geocode Maps client to ensure API compatibility

---

**Review Guidelines for Reviewers:**

When reviewing this PR, please check:
- [ ] Code quality and adherence to project standards
- [ ] Test coverage is adequate
- [ ] Documentation is clear and complete
- [ ] No security vulnerabilities introduced
- [ ] Performance impact is acceptable
- [ ] Breaking changes are properly documented
- [ ] Deployment plan is clear and safe