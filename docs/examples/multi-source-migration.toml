# Multi-Source Database Configuration - Migration Example
# This example shows how to migrate from single-database to multi-source configuration
# with backward compatibility and step-by-step migration path

# ============================================================================
# STEP 1: SINGLE DATABASE (LEGACY MODE)
# ============================================================================
# Your current configuration (before migration):
#
# [database]
# path = "bot.db"
# max_connections = 5
# timeout = 30
#
# Python code:
# db = DatabaseWrapper(dbPath="bot.db", maxConnections=5, timeout=30.0)

# ============================================================================
# STEP 2: CONVERT TO MULTI-SOURCE (BACKWARD COMPATIBLE)
# ============================================================================
# First migration step - same functionality, new structure

[database]
default = "primary"

[database.sources.primary]
path = "bot.db"  # Same database file as before
readonly = false
pool-size = 5    # Same as old maxConnections
timeout = 30.0   # Same as before

# At this point, your bot works exactly the same as before!
# No chat mappings needed yet - everything uses "primary" source

# ============================================================================
# STEP 3: ADD ARCHIVE DATABASE (OPTIONAL)
# ============================================================================
# Once comfortable with multi-source, add an archive database

# Uncomment to enable archive:
# [database.sources.archive]
# path = "archive.db"
# readonly = true  # Readonly for safety
# pool-size = 3
# timeout = 30.0

# ============================================================================
# STEP 4: MAP OLD CHATS TO ARCHIVE (OPTIONAL)
# ============================================================================
# Gradually move old/inactive chats to archive

# Uncomment and add your old chat IDs:
# [database.chatMapping]
# -1001234567890 = "archive"  # Old chat from 2023
# -1002345678901 = "archive"  # Another old chat

# ============================================================================
# STEP 5: ADD MORE SOURCES AS NEEDED (OPTIONAL)
# ============================================================================

# Example: Test database for development
# [database.sources.test]
# path = "test.db"
# readonly = false
# pool-size = 5
# timeout = 30.0

# Example: External bot database (readonly)
# [database.sources.other_bot]
# path = "/shared/other_bot.db"
# readonly = true
# pool-size = 2
# timeout = 10.0

# ============================================================================
# MIGRATION CHECKLIST
# ============================================================================

# Before Migration:
# [ ] Backup your current database
# [ ] Test multi-source config in development first
# [ ] Verify all existing functionality works

# During Migration:
# [ ] Start with Step 2 (single source in multi-source format)
# [ ] Test thoroughly before adding more sources
# [ ] Add archive database (Step 3)
# [ ] Gradually map old chats to archive (Step 4)
# [ ] Monitor performance and adjust pool sizes

# After Migration:
# [ ] Verify all chats are accessible
# [ ] Check that writes work correctly
# [ ] Confirm readonly protection works
# [ ] Monitor connection pool usage
# [ ] Adjust configuration as needed

# ============================================================================
# ROLLBACK PLAN
# ============================================================================

# If you need to rollback to single-database mode:
#
# Option 1: Use legacy constructor
# db = DatabaseWrapper(dbPath="bot.db", maxConnections=5, timeout=30.0)
#
# Option 2: Keep multi-source config with single source
# (This is actually recommended - gives you flexibility for future)

# ============================================================================
# COMMON MIGRATION ISSUES
# ============================================================================

# Issue 1: "Cannot perform write operation on readonly source"
# Solution: Check if chat is mapped to readonly source
#          Remove from chatMapping or change source to writable

# Issue 2: "Source 'name' not found in configuration"
# Solution: Verify source name spelling in chatMapping
#          Ensure source is defined in [database.sources.name]

# Issue 3: Performance degradation
# Solution: Adjust pool-size values
#          Use explicit dataSource for known locations
#          Consider separating high-traffic chats

# ============================================================================
# BEST PRACTICES FOR MIGRATION
# ============================================================================

# 1. Start Simple
#    - Begin with single source in multi-source format
#    - Add complexity gradually

# 2. Test Thoroughly
#    - Test each migration step in development
#    - Verify backward compatibility

# 3. Monitor Performance
#    - Watch connection pool usage
#    - Adjust pool sizes based on actual load

# 4. Use Readonly Wisely
#    - Mark archives as readonly
#    - Protect external/shared databases

# 5. Document Changes
#    - Keep track of chat mappings
#    - Document why chats are in specific sources

# ============================================================================
# EXAMPLE PYTHON CODE FOR MIGRATION
# ============================================================================

# Before (single database):
# from internal.database import DatabaseWrapper
# db = DatabaseWrapper(dbPath="bot.db")

# After (multi-source, backward compatible):
# from internal.database import DatabaseWrapper
# config = {
#     "default": "primary",
#     "sources": {
#         "primary": {
#             "path": "bot.db",
#             "readonly": False,
#             "pool-size": 5,
#             "timeout": 30.0
#         }
#     }
# }
# db = DatabaseWrapper(config=config)

# Later (with archive):
# config["sources"]["archive"] = {
#     "path": "archive.db",
#     "readonly": True,
#     "pool-size": 3,
#     "timeout": 30.0
# }
# config["chatMapping"] = {
#     -1001234567890: "archive"
# }
# db = DatabaseWrapper(config=config)