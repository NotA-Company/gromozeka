on:
  pull_request:
    - workflows: make-test
  push:
    - workflows: make-test

workflows:
  make-test:
    tasks:
      - do-make-test
      
tasks:
  - name: do-make-test
    cubes: 
      - name: prepare-environvent
        image: docker.io/library/alpine:3.22
        script:
          - apk add --no-cache gcc libmagic make musl-dev py3-pip python3 sqlite
      - name: make-venv
        script:
          - make venv
      - name: install-deps
        script:
          - make install
      - name: run-linter
        script:
          - make check
      - name: run-tests
        script:
          - make test 

    
