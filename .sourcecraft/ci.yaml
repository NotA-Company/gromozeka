on:
  pull_request:
    - workflows: make-test
      filter:
        # source_branches: ["**", "!test**"]
        target_branches: ["main", "master", "trunk"]
  push:
    - workflows: make-test
      filter:
        branches: ["main", "master", "trunk"]

workflows:
  make-test:
    tasks:
      - do-make-test
      
tasks:
  - name: do-make-test
    cubes: 
      - name: do-make-check-test
        image: docker.io/library/alpine:3.22
        script:
          - apk add --no-cache gcc git libmagic make musl-dev py3-pip python3 sqlite
          - make venv
          - make install
          - make check
          - make test 

    
